openapi: 3.0.0
info:
  title: Wekeza Open Banking API
  version: 1.0.0
  description: Complete API for Wekeza Bank Open Banking Platform
  contact:
    name: Wekeza Bank
    email: developers@wekeza.com
    url: https://developers.wekeza.com

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://sandbox.wekeza.com
    description: Sandbox environment
  - url: https://api.wekeza.com
    description: Production environment

security:
  - BearerAuth: []

paths:
  /health:
    get:
      summary: Health check
      tags:
        - System
      security: []
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: wekeza-api-server
                  version:
                    type: string
                    example: v1

  /oauth/token:
    post:
      summary: Get OAuth access token
      tags:
        - Authentication
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                grant_type:
                  type: string
                  enum: [client_credentials, refresh_token]
                client_id:
                  type: string
                client_secret:
                  type: string
                refresh_token:
                  type: string
                scope:
                  type: string
      responses:
        '200':
          description: Token generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'

  /api/v1/accounts:
    get:
      summary: List accounts
      tags:
        - Accounts
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of accounts
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Account'

  /api/v1/accounts/{id}:
    get:
      summary: Get account details
      tags:
        - Accounts
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Account details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'

  /api/v1/accounts/{id}/balance:
    get:
      summary: Get account balance
      tags:
        - Accounts
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Account balance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Balance'

  /api/v1/accounts/{id}/transactions:
    get:
      summary: Get account transactions
      tags:
        - Accounts
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: fromDate
          in: query
          schema:
            type: string
            format: date
        - name: toDate
          in: query
          schema:
            type: string
            format: date
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'

  /api/v1/payments:
    post:
      summary: Initiate payment
      tags:
        - Payments
      parameters:
        - name: Idempotency-Key
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '201':
          description: Payment initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
    get:
      summary: List payments
      tags:
        - Payments
      parameters:
        - name: sourceAccountId
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of payments
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payment'

  /api/v1/payments/{id}:
    get:
      summary: Get payment details
      tags:
        - Payments
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'

  /api/v1/payments/{id}/status:
    get:
      summary: Get payment status
      tags:
        - Payments
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payment status
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  paymentRef:
                    type: string
                  status:
                    type: string
                  completedAt:
                    type: string
                    format: date-time

  /api/v1/webhooks:
    post:
      summary: Register webhook
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  format: uri
                events:
                  type: array
                  items:
                    type: string
                secret:
                  type: string
      responses:
        '201':
          description: Webhook registered
    get:
      summary: List webhooks
      tags:
        - Webhooks
      responses:
        '200':
          description: List of webhooks

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          example: Bearer
        expires_in:
          type: integer
          example: 3600

    Account:
      type: object
      properties:
        id:
          type: string
        accountNumber:
          type: string
        accountType:
          type: string
        currency:
          type: string
        balance:
          type: number
        availableBalance:
          type: number
        status:
          type: string
        customer:
          type: object

    Balance:
      type: object
      properties:
        balance:
          type: number
        available:
          type: number
        currency:
          type: string

    Transaction:
      type: object
      properties:
        id:
          type: string
        transactionRef:
          type: string
        type:
          type: string
        amount:
          type: number
        currency:
          type: string
        description:
          type: string
        status:
          type: string
        transactionDate:
          type: string
          format: date-time

    PaymentRequest:
      type: object
      required:
        - sourceAccountId
        - destinationAccountNumber
        - amount
      properties:
        sourceAccountId:
          type: string
        destinationAccountNumber:
          type: string
        amount:
          type: number
          minimum: 0.01
        currency:
          type: string
          default: KES
        reference:
          type: string
        description:
          type: string

    Payment:
      type: object
      properties:
        id:
          type: string
        paymentRef:
          type: string
        sourceAccountId:
          type: string
        destinationAccountNumber:
          type: string
        amount:
          type: number
        currency:
          type: string
        reference:
          type: string
        description:
          type: string
        status:
          type: string
        riskScore:
          type: number
        completedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
